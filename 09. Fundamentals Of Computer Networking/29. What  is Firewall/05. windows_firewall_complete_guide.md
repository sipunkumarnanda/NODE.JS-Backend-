

# How to use Windows Firewall ‚Äî complete guide üß≠

---

## Overview ‚Äî what you‚Äôll learn üìö

* How to open and navigate Windows Firewall UI
* Firewall **profiles** (Domain / Private / Public) and their meaning
* Enable / disable firewall (GUI, PowerShell, netsh)
* Allow an app or feature through the firewall
* Create inbound/outbound rules (Program, Port, Predefined, Custom) step‚Äëby‚Äëstep
* Advanced settings: rule properties, profiles, IP restrictions, edge traversal
* Logging, monitoring, export/import, restore defaults
* PowerShell & netsh equivalents for automation
* Troubleshooting and best practices ‚úÖ

---

## Open Windows Firewall (two easy ways) üñ±Ô∏è

**Method A ‚Äî Settings (simpler)**

1. Start ‚Üí Settings ‚Üí `Network & Internet` ‚Üí `Status` ‚Üí click **Windows Defender Firewall** (or `Firewall & network protection`).
2. You‚Äôll see the three network profiles and quick actions.

**Method B ‚Äî Advanced (recommended for rules)**

1. Start ‚Üí type **Windows Defender Firewall with Advanced Security** ‚Üí open it.
2. This GUI (WFAS) contains Inbound Rules, Outbound Rules, Connection Security Rules, Monitoring, and Profiles.

---

## Firewall profiles ‚Äî what they do üè†üè¢üõë

* **Domain** ‚Äî used when joined to an Active Directory domain (managed by admins).
* **Private** ‚Äî trusted home/office networks; file/printer sharing is allowed per rules.
* **Public** ‚Äî untrusted networks (coffee shops); stricter by default, inbound blocked.
  Rules can be applied to one or more profiles. Choose profile carefully when creating rules.

---

## Enable / Disable Windows Firewall ‚úÖ‚ùå

**GUI**

* Settings ‚Üí `Firewall & network protection` ‚Üí choose a profile (Domain/Private/Public) ‚Üí toggle **Microsoft Defender Firewall** On/Off.
* You can also enable the notification option: ‚ÄúNotify me when Windows Defender Firewall blocks a new app‚Äù.

**PowerShell**

```powershell
# Enable for all profiles
Set-NetFirewallProfile -Profile Domain,Private,Public -Enabled True

# Disable for all profiles (NOT recommended)
Set-NetFirewallProfile -Profile Domain,Private,Public -Enabled False
```

**netsh**

```powershell
# Enable
netsh advfirewall set allprofiles state on

# Disable
netsh advfirewall set allprofiles state off
```

‚ö†Ô∏è **Warning:** Disabling the firewall exposes you to attacks. Only do it temporarily for debugging.

---

## Allow an app through the firewall (GUI) üßæ‚û°Ô∏èüåê

**Simple method (for most users):**

1. Control Panel ‚Üí `System and Security` ‚Üí `Windows Defender Firewall` ‚Üí click **Allow an app or feature through Windows Defender Firewall**.
2. Click **Change settings** (admin) ‚Üí check the app and the profiles (Private/Public) to allow.
3. If not present, click **Allow another app‚Ä¶**, browse to the program executable (`.exe`) and add it.

**Advanced (WFAS) ‚Äî program rule**

1. Open **Windows Defender Firewall with Advanced Security**.
2. Choose **Inbound Rules** ‚Üí **New Rule‚Ä¶** ‚Üí select **Program** ‚Üí Next.
3. Path to program ‚Üí Allow the connection / Block the connection ‚Üí select profiles ‚Üí name the rule ‚Üí Finish.

---

## Create a Port rule (allow/block a port) üîå

**Use case:** open port 3389 for RDP (only on Private network).

**GUI (Inbound example)**

1. WFAS ‚Üí **Inbound Rules** ‚Üí **New Rule‚Ä¶** ‚Üí choose **Port** ‚Üí Next.
2. Select **TCP** or **UDP**, enter **Specific local ports** (e.g., `3389`) ‚Üí Next.
3. Choose **Allow the connection** (or Block) ‚Üí select profiles (e.g., Private) ‚Üí give it a name and Finish.

**PowerShell**

```powershell
# Allow TCP port 3389 on Private profile
New-NetFirewallRule -DisplayName "Allow RDP Private" -Direction Inbound -Protocol TCP -LocalPort 3389 -Action Allow -Profile Private
```

**netsh**

```powershell
netsh advfirewall firewall add rule name="Allow RDP Private" dir=in action=allow protocol=TCP localport=3389 profile=private
```

**Security tip:** Only open ports you need and restrict to specific remote IPs where possible.

---

## Create an Outbound rule (block or allow outgoing traffic) ‚ÜóÔ∏è

**GUI**

1. WFAS ‚Üí **Outbound Rules** ‚Üí **New Rule‚Ä¶** ‚Üí choose **Program** or **Port**.
2. For programs: browse to `.exe` and choose **Block the connection** if you want to prevent it from sending data out.
3. Select profiles and name it.

**PowerShell (block a program outbound)**

```powershell
New-NetFirewallRule -DisplayName "Block BadApp Out" -Program "C:\Path\BadApp.exe" -Direction Outbound -Action Block -Profile Any
```

**Common use:** block unknown P2P or suspicious apps from contacting external servers.

---

## Custom rules ‚Äî powerful & detailed üõ†Ô∏è

When you choose **Custom** in the New Rule wizard, you can specify:

* Program path and services
* Protocol type and local/remote ports
* Local and remote IP address ranges (whitelist/blacklist)
* Interface types (LAN, wireless, remote access)
* Edge traversal (allow traffic through NAT/firewall traversal)
* Security (require authentication, connection security rules)

Use custom rules when you need fine-grained control (e.g., allow only a specific remote IP to connect to a port).

---

## Rule properties explained (what each field means) üßæ

When editing a rule, pay attention to:

* **General**: Enabled/Disabled, Action (Allow/Block), Name, Description.
* **Programs and Services**: Which executable is affected.
* **Protocols and Ports**: TCP/UDP/ICMP, specific local/remote ports.
* **Scope**: Local/Remote IP addresses (restrict to IPs/subnets).
* **Advanced**: Profiles (Domain/Private/Public), Interface types, Edge traversal.
* **Grouping**: Put related rules in a group for easier management.

---

## Connection Security Rules (IPsec) üîê

* These rules configure IPsec policies (require authentication, encryption, tunnel mode) between two endpoints.
* Use if you need encrypted L2 traffic between hosts or to enforce machine/user authentication for connections.
* Typically deployed in enterprise environments.

---

## Logging & Monitoring üìú

**Enable logging:**

1. WFAS ‚Üí right-click **Windows Defender Firewall with Advanced Security on Local Computer** ‚Üí **Properties**.
2. Under each profile tab (Domain/Private/Public) ‚Üí Logging ‚Üí click **Customize** ‚Üí configure **Log dropped packets** and **Log successful connections**, and set **Log file location** (default: `%systemroot%\system32\LogFiles\Firewall\pfirewall.log`).

**Monitor rules and active connections:**

* WFAS ‚Üí **Monitoring** ‚Üí view active firewall rules, connection security rules, and the active firewall rules in effect.

**View log file:** Open `pfirewall.log` in a text editor to see dropped/allowed packet entries.

---

## Export / Import / Backup rules üíæ

**Export (GUI)**

* WFAS ‚Üí Action ‚Üí **Export Policy‚Ä¶** ‚Üí save as `.wfw`.

**Import**

* WFAS ‚Üí Action ‚Üí **Import Policy‚Ä¶** ‚Üí select `.wfw`.

**PowerShell**

* You can export/select rules using `Get-NetFirewallRule` and export objects to file (for automation).

---

## Restore defaults / Reset firewall üîÑ

**GUI**

* WFAS ‚Üí Action ‚Üí **Restore Default Policy** (this removes all user-created rules).

**netsh**

```powershell
netsh advfirewall reset
```

**PowerShell**

```powershell
# There isn't a single cmdlet to "reset" like netsh; use netsh or remove rules with PowerShell functions
```

‚ö†Ô∏è Resetting deletes custom rules ‚Äî export first if you may need them again.

---

## Command-line & PowerShell quick reference ‚ö°

**View profiles**

```powershell
Get-NetFirewallProfile
```

**List rules**

```powershell
Get-NetFirewallRule | Format-Table -AutoSize
```

**Create rule (example)**

```powershell
New-NetFirewallRule -DisplayName "Allow HTTP In" -Direction Inbound -Protocol TCP -LocalPort 80 -Action Allow -Profile Any
```

**Disable/Enable a rule**

```powershell
Disable-NetFirewallRule -DisplayName "Allow HTTP In"
Enable-NetFirewallRule -DisplayName "Allow HTTP In"
```

**Delete a rule**

```powershell
Remove-NetFirewallRule -DisplayName "Allow HTTP In"
```

**Set profile state**

```powershell
Set-NetFirewallProfile -Profile Domain -Enabled True
```

**netsh example to add rule**

```powershell
netsh advfirewall firewall add rule name="Allow HTTPS" dir=in action=allow protocol=TCP localport=443 profile=any
```

---

## Common tasks ‚Äî step‚Äëby‚Äëstep examples üß≠

### A. Allow Remote Desktop only on Private networks

**GUI**

1. WFAS ‚Üí Inbound Rules ‚Üí find **Remote Desktop (TCP-In)** ‚Üí right-click ‚Üí Properties.
2. On **Advanced** tab ‚Üí check only **Private** profile (uncheck Public). Apply.

**PowerShell**

```powershell
Set-NetFirewallRule -DisplayName "Remote Desktop - User Mode (TCP-In)" -Profile Private
```

### B. Block a program from accessing internet (outbound)

**GUI**

1. WFAS ‚Üí Outbound Rules ‚Üí New Rule ‚Üí Program ‚Üí browse exe ‚Üí Block the connection ‚Üí choose profiles ‚Üí name it.

**PowerShell**

```powershell
New-NetFirewallRule -DisplayName "Block BadApp" -Program "C:\Apps\BadApp.exe" -Direction Outbound -Action Block
```

### C. Allow SSH from a specific IP only

**GUI**

1. New Inbound Rule ‚Üí Port ‚Üí TCP 22 ‚Üí Allow ‚Üí Under Scope ‚Üí specify Remote IP (e.g., `203.0.113.5`) ‚Üí Finish.

**PowerShell**

```powershell
New-NetFirewallRule -DisplayName "Allow SSH From AdminIP" -Direction Inbound -Protocol TCP -LocalPort 22 -Action Allow -RemoteAddress 203.0.113.5
```

---

## Troubleshooting üîç

* **Firewall service disabled?** Check service `Windows Defender Firewall` is running.
* **Rule conflicts:** More specific rules override generic ones. Disabled rules do nothing.
* **Group Policy overrides:** On domain-joined machines rules may be set by Group Policy; local changes can be prevented. Use `gpresult /h report.html` to diagnose.
* **Port still closed:** Verify app listens on the port (`netstat -anb`), check router/NAT port forwarding if external access needed.
* **Firewall logs:** check `pfirewall.log` to see dropped packets and decide on rule adjustments.
* **Edge traversal/NAT:** If a program needs to traverse NAT, enable Edge traversal only if safe.

---

## Best practices ‚úÖ

* Keep firewall **enabled** at all times.
* **Restrict inbound** traffic to what‚Äôs necessary; prefer default block for inbound.
* Use **least privilege**: allow minimum ports, apps, and IP addresses.
* Use different rules for domain/private/public profiles.
* **Log dropped packets** to detect suspicious traffic.
* Avoid permanently disabling firewall to troubleshoot ‚Äî re-enable quickly after testing.
* Use **PowerShell** or group policy for consistent, auditable rule deployment in organizations.
* Regularly **review and remove** stale/unneeded rules.

---

## Security tips & cautions üîê

* Don‚Äôt open RDP to the internet unless you have strong authentication (VPN, IP restriction, MFA).
* Outbound allow-by-default is convenient but consider blocking risky apps in high-security environments.
* Be careful with Edge traversal ‚Äî it may expose services unexpectedly.
* When editing rules, include clear **display names** and **descriptions** so other admins understand purpose.

---