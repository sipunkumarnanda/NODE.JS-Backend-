

# 🔑 SSH Key Management and `ssh-keygen` — Complete Guide

---

## 🌟 What is `ssh-keygen`?

`ssh-keygen` is a command-line utility to **generate SSH key pairs** (public and private keys) for secure authentication.

**Key points:**

* Creates **public and private key pairs**
* Supports multiple algorithms: ED25519, RSA, ECDSA
* Stores keys in `~/.ssh` directory by default

---

## 🗂️ Where SSH Keys Are Stored

| Key                | Default Location                               | Purpose                                            |
| ------------------ | ---------------------------------------------- | -------------------------------------------------- |
| Private Key 🔒     | `~/.ssh/id_ed25519` or `~/.ssh/id_rsa`         | Kept **secret**, used to prove identity            |
| Public Key 🔓      | `~/.ssh/id_ed25519.pub` or `~/.ssh/id_rsa.pub` | Can be shared, added to server’s `authorized_keys` |
| Authorized Keys 📁 | `~/.ssh/authorized_keys` (on server)           | List of public keys allowed to log in              |

> 🔹 Important: **Never share your private key.** The public key is safe to distribute.

---

## 🛠️ Generating an SSH Key Pair

### 1️⃣ Command

```bash
ssh-keygen -t ed25519 -C "your_email@example.com"
```

**Explanation:**

* `-t ed25519` → key type (modern, fast, secure)
* `-C "your_email@example.com"` → optional comment for identification
* Press **Enter** to accept default file location (`~/.ssh/id_ed25519`)
* Optional: enter a **passphrase** for extra security 🔐

**Output example:**

```
Your identification has been saved in /home/user/.ssh/id_ed25519
Your public key has been saved in /home/user/.ssh/id_ed25519.pub
```

---

## 🏠 Checking `.ssh` Folder on Server

Before adding keys on the server:

```bash
ls -la ~/
```

* If `.ssh` folder exists → ✅ Use it
* If not → create it:

```bash
mkdir -p ~/.ssh
chmod 700 ~/.ssh  # secure permissions
```

> 🔹 `-p` ensures all parent directories are created if missing

---

## 📁 Creating `authorized_keys` File

Inside the `.ssh` folder:

```bash
cd ~/.ssh
touch authorized_keys       # create file if it doesn't exist
chmod 600 authorized_keys   # secure permissions
```

---

## ✍️ Adding the Public Key

1. Open `authorized_keys` in a text editor:

```bash
nano authorized_keys
```

2. Paste the **public key** (`id_ed25519.pub`) into the file:

```
ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAICxZ6... user@machine
```

3. Save the file:

* Press `Ctrl + X` → `Y` → `Enter`

> 🔹 The server now trusts this key for login.

---

## 🔐 Permissions and Security

* `.ssh` folder → `700`
* `authorized_keys` → `600`
* Private keys (local machine) → `600`

```bash
chmod 700 ~/.ssh
chmod 600 ~/.ssh/authorized_keys
chmod 600 ~/.ssh/id_ed25519
```

> ⚠️ Incorrect permissions can **break SSH login**.

---

## 🚀 Connecting Using the Key

From your client machine:

```bash
ssh -i ~/.ssh/id_ed25519 user@server
```

* `-i` → specifies private key file
* If no passphrase → login is immediate
* If passphrase → SSH prompts for it

---

## 🔄 Optional: Automate Key Usage with `ssh-agent`

Start the agent and add your key:

```bash
eval "$(ssh-agent -s)"
ssh-add ~/.ssh/id_ed25519
```

* Allows using key without typing passphrase every time
* Works well for scripts and automation

---

## 🧠 Summary of Steps (Server Side)

1. Check for `.ssh` folder:

   ```bash
   ls -la ~/
   ```
2. Create folder if missing:

   ```bash
   mkdir -p ~/.ssh
   chmod 700 ~/.ssh
   ```
3. Create `authorized_keys`:

   ```bash
   touch authorized_keys
   chmod 600 authorized_keys
   ```
4. Paste the public key into `authorized_keys` using `nano`
5. Save and exit (`Ctrl+X`, `Y`, `Enter`)
6. Ensure permissions are correct

---

## ✅ Key Takeaways

* `ssh-keygen` creates **public/private key pairs** for secure SSH authentication 🔑
* `.ssh` folder stores keys and `authorized_keys` file
* Proper **permissions** are essential for SSH login 🔒
* Public key goes on the server, private key stays on your client
* Use `ssh-agent` for convenience with passphrases

---